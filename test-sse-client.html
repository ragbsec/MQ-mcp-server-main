<!DOCTYPE html>
<html>
<head>
    <title>SSE MCP Client Test</title>
</head>
<body>
    <h1>SSE MCP Client Test</h1>
    <div id="status">Connecting...</div>
    <div id="messages"></div>
    <button onclick="listTools()">List Tools</button>
    <button onclick="testDspmq()">Test dspmq</button>

    <script>
        let eventSource;
        
        function connect() {
            eventSource = new EventSource('http://localhost:8000/mcp/sse');
            
            eventSource.onopen = function(event) {
                document.getElementById('status').innerHTML = 'Connected to SSE';
            };
            
            eventSource.onmessage = function(event) {
                const data = JSON.parse(event.data);
                document.getElementById('messages').innerHTML += '<p>' + JSON.stringify(data) + '</p>';
            };
            
            eventSource.onerror = function(event) {
                document.getElementById('status').innerHTML = 'Connection failed';
            };
        }
        
        function sendMessage(message) {
            fetch('http://localhost:8000/mcp/message', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(message)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('messages').innerHTML += '<p><strong>Response:</strong> ' + JSON.stringify(data) + '</p>';
            });
        }
        
        function listTools() {
            sendMessage({
                "jsonrpc": "2.0",
                "id": 1,
                "method": "tools/list"
            });
        }
        
        function testDspmq() {
            sendMessage({
                "jsonrpc": "2.0",
                "id": 2,
                "method": "tools/call",
                "params": {
                    "name": "dspmq",
                    "arguments": {}
                }
            });
        }
        
        connect();
    </script>
</body>
</html>